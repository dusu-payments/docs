
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Dusupay Documentation - Merchant API Documentation</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen-5ee58de1.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print-41bbd87c.css" rel="stylesheet" media="print" />
      <script src="javascripts/all-c5541673.js"></script>
  </head>

  <body class="index" data-languages="[&quot;json&quot;,&quot;shell&quot;,&quot;javascript&quot;,&quot;php&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar-cad8cdcb.png" alt="Navbar" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="images/logo-9dbe0190.png" class="logo" alt="Logo" />
        <div class="lang-selector">
              <a href="#" data-language-name="json">JS/Json</a>
              <a href="#" data-language-name="shell">Shell</a>
              <a href="#" data-language-name="javascript">NodeJS</a>
              <a href="#" data-language-name="php">PHP</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <ul id="toc" class="toc-list-h1">
          <li>
            <a href="#introduction" class="toc-h1 toc-link" data-title="Introduction">Introduction</a>
          </li>
          <li>
            <a href="#get-started" class="toc-h1 toc-link" data-title="Get started">Get started</a>
          </li>
          <li>
            <a href="#request-response" class="toc-h1 toc-link" data-title="Request/Response">Request/Response</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#request" class="toc-h2 toc-link" data-title="Request">Request</a>
                  </li>
                  <li>
                    <a href="#response" class="toc-h2 toc-link" data-title="Response">Response</a>
                  </li>
                  <li>
                    <a href="#response-codes" class="toc-h2 toc-link" data-title="Response codes">Response codes</a>
                  </li>
                  <li>
                    <a href="#key-notes-in-a-nutshell" class="toc-h2 toc-link" data-title="Key notes in a nutshell">Key notes in a nutshell</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#integration-workflow" class="toc-h1 toc-link" data-title="Integration Workflow">Integration Workflow</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#get-provider_ids" class="toc-h2 toc-link" data-title="Get provider_ids">Get provider_ids</a>
                  </li>
                  <li>
                    <a href="#collecting-funds" class="toc-h2 toc-link" data-title="Collecting funds">Collecting funds</a>
                  </li>
                  <li>
                    <a href="#paying-out-funds" class="toc-h2 toc-link" data-title="Paying out funds">Paying out funds</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#request-authorization" class="toc-h1 toc-link" data-title="Request Authorization">Request Authorization</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#at-collection" class="toc-h2 toc-link" data-title="At Collection">At Collection</a>
                  </li>
                  <li>
                    <a href="#at-payout" class="toc-h2 toc-link" data-title="At Payout">At Payout</a>
                  </li>
                  <li>
                    <a href="#obtaining-api-keys" class="toc-h2 toc-link" data-title="Obtaining API keys">Obtaining API keys</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#receiving-money" class="toc-h1 toc-link" data-title="Receiving Money">Receiving Money</a>
          </li>
          <li>
            <a href="#introduction" class="toc-h1 toc-link" data-title="Introduction">Introduction</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#how-it-work" class="toc-h2 toc-link" data-title="How it work">How it work</a>
                  </li>
                  <li>
                    <a href="#example" class="toc-h2 toc-link" data-title="Example">Example</a>
                  </li>
                  <li>
                    <a href="#take-note" class="toc-h2 toc-link" data-title="Take Note">Take Note</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#collection" class="toc-h1 toc-link" data-title="Collection">Collection</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#sample-request" class="toc-h2 toc-link" data-title="Sample Request">Sample Request</a>
                  </li>
                  <li>
                    <a href="#special-parameters" class="toc-h2 toc-link" data-title="Special Parameters">Special Parameters</a>
                  </li>
                  <li>
                    <a href="#sample-response" class="toc-h2 toc-link" data-title="Sample Response">Sample Response</a>
                  </li>
                  <li>
                    <a href="#card-payments" class="toc-h2 toc-link" data-title="Card Payments">Card Payments</a>
                  </li>
                  <li>
                    <a href="#crypto-payments" class="toc-h2 toc-link" data-title="Crypto Payments">Crypto Payments</a>
                  </li>
                  <li>
                    <a href="#redirect-url" class="toc-h2 toc-link" data-title="Redirect URL">Redirect URL</a>
                  </li>
                  <li>
                    <a href="#redirect-data" class="toc-h2 toc-link" data-title="Redirect Data">Redirect Data</a>
                  </li>
                  <li>
                    <a href="#direct-card-collections" class="toc-h2 toc-link" data-title="Direct Card Collections">Direct Card Collections</a>
                  </li>
                  <li>
                    <a href="#get-list-of-verification-countries" class="toc-h2 toc-link" data-title="GET List of verification countries">GET List of verification countries</a>
                  </li>
                  <li>
                    <a href="#get-download-the-public-key" class="toc-h2 toc-link" data-title="GET/Download the public key">GET/Download the public key</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#sending-money" class="toc-h1 toc-link" data-title="Sending Money">Sending Money</a>
          </li>
          <li>
            <a href="#introduction" class="toc-h1 toc-link" data-title="Introduction">Introduction</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#how-it-work" class="toc-h2 toc-link" data-title="How it work">How it work</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#payout" class="toc-h1 toc-link" data-title="Payout">Payout</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#sample-request" class="toc-h2 toc-link" data-title="Sample Request">Sample Request</a>
                  </li>
                  <li>
                    <a href="#extra-parameters" class="toc-h2 toc-link" data-title="Extra parameters">Extra parameters</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#miscellaneous" class="toc-h1 toc-link" data-title="Miscellaneous">Miscellaneous</a>
          </li>
          <li>
            <a href="#transaction-statuses" class="toc-h1 toc-link" data-title="Transaction Statuses">Transaction Statuses</a>
          </li>
          <li>
            <a href="#webhooks-ipns" class="toc-h1 toc-link" data-title="Webhooks/IPNs">Webhooks/IPNs</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#setting-webhook" class="toc-h2 toc-link" data-title="Setting webhook">Setting webhook</a>
                  </li>
                  <li>
                    <a href="#calling-webhook" class="toc-h2 toc-link" data-title="Calling webhook">Calling webhook</a>
                  </li>
                  <li>
                    <a href="#accepting-webhook" class="toc-h2 toc-link" data-title="Accepting webhook">Accepting webhook</a>
                  </li>
                  <li>
                    <a href="#responding-to-webhooks" class="toc-h2 toc-link" data-title="Responding to webhooks">Responding to webhooks</a>
                  </li>
                  <li>
                    <a href="#rejecting-webhook" class="toc-h2 toc-link" data-title="Rejecting webhook">Rejecting webhook</a>
                  </li>
                  <li>
                    <a href="#note" class="toc-h2 toc-link" data-title="Note">Note</a>
                  </li>
                  <li>
                    <a href="#sample-collection-ipn-data" class="toc-h2 toc-link" data-title="Sample Collection IPN Data">Sample Collection IPN Data</a>
                  </li>
                  <li>
                    <a href="#sample-payout-ipn-data" class="toc-h2 toc-link" data-title="Sample Payout IPN Data">Sample Payout IPN Data</a>
                  </li>
                  <li>
                    <a href="#sample-refund-ipn-data" class="toc-h2 toc-link" data-title="Sample Refund IPN Data">Sample Refund IPN Data</a>
                  </li>
                  <li>
                    <a href="#callback-signature-verification-optional" class="toc-h2 toc-link" data-title="Callback Signature Verification (Optional)">Callback Signature Verification (Optional)</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#payment-options-providers-api" class="toc-h1 toc-link" data-title="Payment Options/providers Api">Payment Options/providers Api</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#description" class="toc-h2 toc-link" data-title="Description">Description</a>
                  </li>
                  <li>
                    <a href="#request-description" class="toc-h2 toc-link" data-title="Request Description">Request Description</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#bank-branches-api" class="toc-h1 toc-link" data-title="Bank Branches Api">Bank Branches Api</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#request-headers" class="toc-h2 toc-link" data-title="Request Headers">Request Headers</a>
                  </li>
                  <li>
                    <a href="#request-query-parameters" class="toc-h2 toc-link" data-title="Request Query Parameters">Request Query Parameters</a>
                  </li>
                  <li>
                    <a href="#request-url-parameters" class="toc-h2 toc-link" data-title="Request Url Parameters">Request Url Parameters</a>
                  </li>
                  <li>
                    <a href="#response-fields" class="toc-h2 toc-link" data-title="Response Fields">Response Fields</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#account-balance" class="toc-h1 toc-link" data-title="Account Balance">Account Balance</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#request-headers" class="toc-h2 toc-link" data-title="Request Headers">Request Headers</a>
                  </li>
                  <li>
                    <a href="#query-parameters" class="toc-h2 toc-link" data-title="Query Parameters">Query Parameters</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#refund" class="toc-h1 toc-link" data-title="Refund">Refund</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#request-headers" class="toc-h2 toc-link" data-title="Request Headers">Request Headers</a>
                  </li>
                  <li>
                    <a href="#query-parameters" class="toc-h2 toc-link" data-title="Query Parameters">Query Parameters</a>
                  </li>
                  <li>
                    <a href="#note" class="toc-h2 toc-link" data-title="Note">Note</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#testing-sandbox" class="toc-h1 toc-link" data-title="Testing Sandbox">Testing Sandbox</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#description" class="toc-h2 toc-link" data-title="Description">Description</a>
                  </li>
                  <li>
                    <a href="#base-url" class="toc-h2 toc-link" data-title="Base URL">Base URL</a>
                  </li>
                  <li>
                    <a href="#test-account" class="toc-h2 toc-link" data-title="Test Account">Test Account</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#faq-frequently-asked-questions" class="toc-h1 toc-link" data-title="FAQ - Frequently Asked Questions">FAQ - Frequently Asked Questions</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#1-where-do-i-find-my-webhook-hash" class="toc-h2 toc-link" data-title="1. Where do i find my webhook hash">1. Where do i find my webhook hash</a>
                  </li>
                  <li>
                    <a href="#2-we-didn-39-t-received-any-notification-callback-ipn-data-or-how-can-see-the-data-request-body-posted-to-the-webhook-url" class="toc-h2 toc-link" data-title="2. We didn't received any notification/callback/IPN data or how can see the data/request body posted to the webhook url">2. We didn't received any notification/callback/IPN data or how can see the data/request body posted to the webhook url</a>
                  </li>
                  <li>
                    <a href="#3-why-provider_id-is-required-even-for-mobile-money-api-requests" class="toc-h2 toc-link" data-title="3. Why provider_id is required even for mobile money api requests">3. Why provider_id is required even for mobile money api requests</a>
                  </li>
                  <li>
                    <a href="#4-are-all-funds-collected-via-different-operators-provider_id-in-the-same-country-combine" class="toc-h2 toc-link" data-title="4. Are all funds collected via different operators/provider_id in the same country combine.">4. Are all funds collected via different operators/provider_id in the same country combine.</a>
                  </li>
                  <li>
                    <a href="#5-are-payouts-now-instant" class="toc-h2 toc-link" data-title="5. Are payouts now instant.">5. Are payouts now instant.</a>
                  </li>
                  <li>
                    <a href="#6-where-are-the-old-dusupay-api-doc" class="toc-h2 toc-link" data-title="6. Where are the old dusupay api doc.">6. Where are the old dusupay api doc.</a>
                  </li>
                  <li>
                    <a href="#7-fnb-bank-south-africa-01-invalid-to-product-number-one-of-our-clients-face-the-error-when-choosing-fnb-bank-for-deposit-what-does-it-mean-what-can-we-recommend-to-the-client" class="toc-h2 toc-link" data-title="7. FNB Bank South Africa - 01 Invalid To Product Number. One of our clients face the error when choosing FNB bank for deposit. What does it mean? What can we recommend to the client?">7. FNB Bank South Africa - 01 Invalid To Product Number. One of our clients face the error when choosing FNB bank for deposit. What does it mean? What can we recommend to the client?</a>
                  </li>
                  <li>
                    <a href="#8-alidropship" class="toc-h2 toc-link" data-title="8. Alidropship">8. Alidropship</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#plugins-and-libraries" class="toc-h1 toc-link" data-title="Plugins And Libraries">Plugins And Libraries</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#plugins" class="toc-h2 toc-link" data-title="Plugins">Plugins</a>
                  </li>
              </ul>
          </li>
      </ul>
        <ul class="toc-footer">
            <li><a href='#'>Merchant API Doc.</a></li>
            <li><a href='#'>dusupay.com</a></li>
            <li><a href='#'>&copy;2015</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='introduction'>Introduction</h1>
<p>This Documentation is dedicated to dusupay Merchants or developers with websites/webapps that have/need to integrate dusupay for payments processing.</p>

<p>Welcome to the Dusupay&#39;s Merchant/Website API Doc! Use this Documentation to send and receive funds on your website or webapp in a more reliable manner.</p>

<p>You can view examples/sample codes in the dark area to the right, where applicable.</p>
<h1 id='get-started'>Get started</h1>
<ol>
<li><p>Go to <a href="https://dashboard.dusupay.com/register">https://dashboard.dusupay.com/register</a> to create a merchant account if you haven&#39;t</p></li>
<li><p>Once you sign in, you will generate API keys (Public and Secret). The secret key should be copied and stored in a safe place because it will be needed for you to carry out payouts.</p></li>
<li><p>You can always re-generate the secret key whenever you thing it&#39;s compromised or need to change it.</p></li>
<li><p>Your account can instantly receive payments as soon as it’s created.
However, to have your account fully approved, contact legal@dusupay.com.</p></li>
</ol>
<h1 id='request-response'>Request/Response</h1><h2 id='request'>Request</h2>
<ul>
<li>The api requires request data as json string data.</li>
</ul>
<h3 id='base-url'>Base Url</h3>
<p>https://api.dusupay.com</p>

<ul>
<li>All production api endpoints have the above base url</li>
</ul>
<h3 id='all-requests'>All Requests</h3>
<ul>
<li>Require http header =&gt; Content-Type: application/json</li>
<li>Whenever you are POSTING data to the api, make sure you are posting a json string to the endpoint.</li>
</ul>
<h2 id='response'>Response</h2>
<ul>
<li>The api only responds with json string data.</li>
</ul>
<h3 id='general-response-format'>General Response format</h3><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">202</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"accepted"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Transaction in Progress"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>code</td>
<td>this is similar to the standard HTTP status codes</td>
</tr>
<tr>
<td>status</td>
<td>simple meaning of the status code</td>
</tr>
<tr>
<td>message</td>
<td>Any message for the data returned</td>
</tr>
<tr>
<td>data</td>
<td>can contain an object or list.</td>
</tr>
</tbody></table>
<h2 id='response-codes'>Response codes</h2>
<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>We will only respond with 200 when transactions complete. Especially for synchronous requests</td>
</tr>
<tr>
<td>202</td>
<td>We have received your request but it has not completed. It’s being processed</td>
</tr>
<tr>
<td>400</td>
<td>When required data or parameters are missing</td>
</tr>
<tr>
<td>401</td>
<td>When the request does not include the api_key and/or the secret-key in the header</td>
</tr>
<tr>
<td>404</td>
<td>When the resource requested is not found</td>
</tr>
<tr>
<td>422</td>
<td>When the request has been received but can not be processed. The reason for failure will always be availed in the message parameter</td>
</tr>
<tr>
<td>500</td>
<td>Request failure due to server error in our system</td>
</tr>
</tbody></table>
<h3 id='nb'>NB</h3>
<ul>
<li>These codes are effected at http level too.</li>
</ul>
<h2 id='key-notes-in-a-nutshell'>Key notes in a nutshell</h2><h3 id='redirection'>Redirection</h3>
<ul>
<li>For collections, always redirect the customer to the <code>payment_url</code> whenever it’s returned otherwise always display to them the instruction messages returned in the api response.</li>
</ul>
<h3 id='async-processing'>Async Processing</h3>
<ul>
<li>Whenever we receive a payment to process, we process it in the background(async) and then notify you when it succeeds or fails via your webhook/callback url/</li>
</ul>
<h3 id='callback-webhook'>Callback/Webhook</h3>
<ul>
<li><p>The Notification data is POSTED to a callback/webhook url that you set under your merchant account API settings. </p></li>
<li><p>We cannot notify more than two urls. Both collection, payout and refund notifications are notified to the same url. We include the transaction_type that can tell the type of transaction.</p></li>
</ul>
<h3 id='payouts'>Payouts</h3>
<ul>
<li>For payouts, some api requests need extra information per country so you need to look out for such e.g Payouts in Ghana need branch_codes on top of the bank_code required. There is an api to avail both bank codes and branch codes where applicable.</li>
</ul>
<h3 id='ipn-security'>IPN Security</h3>
<ul>
<li>Api notifications from us might come from random servers of ours so to ensure that they are coming from us, you need to add a <code>webhook hash</code> as described in the docs. This is a secret key known between you and us that you should validate from your side when a notification is received. 
<br><br>Dusupay does not generate it for you. You simply need to generate a random string of letters and numbers of atleast 16 characters that no one can guess and use it.</li>
</ul>
<h3 id='transaction-status-updates'>Transaction Status updates</h3>
<ul>
<li><p>Sometimes a request might complete and we later get notified that it failed. We will update and notify you again so you should not ignore these notifications.  </p></li>
<li><p>The same applies to failed transactions that could later complete. You could log such unexpected scenarios on your side and seek better explanation where necessary from our support team or check the dashboard to confirm where necessary.</p></li>
<li><p>Note: Payouts are sensitive therefore we always need to watch out for those that fail. We should be more hesitant to mark a payout as failed because it calls for a refund which the customer could payout out again. In the event that there is a resolution that actually the failed payout completed and hence the need to mark it completed, the customer might have received more than they should have. This will mean that the customer could have been paid more than they should hence the need to charge the customer again and debit their account on your platform to recover the double funds if this ever happens.</p></li>
</ul>
<h3 id='sandbox'>Sandbox</h3>
<ul>
<li><p>The sandbox will help you to set up and simulate transactions. It does not store any data and therefore it needs all the data from you. That’s why you will need to pass the callback/webhook url. </p></li>
<li><p>Just make sure you can use the same callback url and it should not be a dynamic url because in production, you will not be able to pass the callback url within the payment request. It has to be set statically under you merchant account in production.</p></li>
</ul>
<h3 id='user-experience-mobile-money'>User Experience - Mobile Money</h3>
<ul>
<li>When integrating collections, make sure that the customer is always aware of what&#39;s going on to prevent repeatitive attempts that could cause your account to be suspended.</li>
<li>For mobile money collections, before you submit an API request to us, prompt the customer to confirm that; 
<br>1. They have sufficient funds on the phone number shown to them
<br>2. And that a mobile money request will be sent to their phone number for approval.</li>
<li>Once the API request is submitted, close that screen and present a new screen displaying the instructions returned to you in the api response.</li>
<li>In the instructions screen, provide a button that leads then to a screen where they can view the status of their transaction request.</li>
<li>Note: The status of the transaction request should be read from your application database because it will be updated when we call you back via the webhook/callback url.</li>
<li>Also, make sure you display the transaction messages to the customer that we return especially when transactions fail. They will help the customer not make repeatitive attempts that could fail with the same reason because they are not made aware.</li>
</ul>
<h1 id='integration-workflow'>Integration Workflow</h1><h2 id='get-provider_ids'>Get provider_ids</h2>
<ul>
<li>To compose requests, you need to be aware of the providers (e.g mtn_ug, bank_ng) enabled.</li>
<li>You can get these from the <a href="#payment-options">payment options api</a></li>
<li>You will need to know the country, request type(collection or payout) and method (BANK, CARD, MOBILE_MONEY) that you want to use. <br> You need to know what kind of request you want to archive first.</li>
<li>You can get the possibilities per country under the <b><code>Supported countries</code></b> section of <a href="#payment-options">here</a></li>
</ul>
<h2 id='collecting-funds'>Collecting funds</h2>
<ol>
<li><p>Go to your merchant account under api settings and get your api/pub key
<br> Set a public callback/webhook url under your merchant account. <a href="#webhooks-ipns">Read more here</a>
<br> Set a webhook-hash to secure your wobhook endpoint. <a href="#accepting-webhook">Read more here</a></p></li>
<li><p>Compose your request data and convert it to a json string</p></li>
<li><p>Set a request header, content-type: application/json . The secret-key header is not needed for collections</p></li>
<li><p>POST the json string to the collections api.</p></li>
<li><p>Decode the json response returned by the api and store any transaction details you need to use later</p></li>
<li><p>We will send callback data when the transaction status changes to the webhook url </p></li>
</ol>
<h2 id='paying-out-funds'>Paying out funds</h2>
<ol>
<li><p>Go to your merchant account under api settings and get your api/pub key
<br> The same url set as webhook url above will be used. The transaction details posted to it will help you identify transactions on your app/website and act accordingly.</p></li>
<li><p>Compose your request data and convert it to a json string</p></li>
<li><p>Set a request header, content-type: application/json . </p></li>
<li><p>Set the secret-key header using the secret key. 
<br>you can re-generate it if you lost it from your merchant account api settings.</p></li>
<li><p>POST the json string to the payouts api.</p></li>
<li><p>Decode the json response returned by the api and store any transaction details you need to use later</p></li>
<li><p>We will send callback data when the transaction status changes to the webhook url </p></li>
</ol>
<h1 id='request-authorization'>Request Authorization</h1><h2 id='at-collection'>At Collection</h2>
<ul>
<li>Only the merchant account <code>api_key</code> data property should be included in the request parameters.</li>
</ul>
<h2 id='at-payout'>At Payout</h2>
<ul>
<li>Both merchant account <code>api_key</code> data property and <code>secret-key</code> header are required.</li>
</ul>
<h3 id='note'>Note</h3>
<ul>
<li><p><code>secret-key</code> should be included in a header named <code>secret-key</code> e.g 
<br><br>
<b>&quot;secret-key: SECK-83he8237gju3yg2i3&quot;</b></p></li>
<li><p>The <code>api_key</code> should be included in the request parameters.</p></li>
</ul>
<h2 id='obtaining-api-keys'>Obtaining API keys</h2>
<ol>
<li><p><code>api_key</code> - Under your merchant account, Click settings from the side menu. Got to API Settings and you will see it.</p></li>
<li><p><code>secret-key</code> - Under the API settings tab, Click the edit(pencil icon) button. Then Generate the secret key.</p></li>
</ol>
<h3 id='note-2'>Note</h3>
<ul>
<li>You need to copy the new secret key to a very safe place because we will not be able to show it to you again.</li>
<li>Whenever you loose your secret key, you will need to generate a new one which always replaces the old one.</li>
</ul>
<h1 id='receiving-money'>Receiving Money</h1><h1 id='introduction'>Introduction</h1><h2 id='how-it-work'>How it work</h2>
<ol>
<li>Customers will pay you using multiple payment options in different countries that have different currencies per provider or network used.</li>
<li>These funds collected are deposited to your merchant account that you created earlier.
Funds can be recieved in multiple currencies and stored as received with no conversion Therefore you will not loose value</li>
<li>Your merchant account is in position to store value in different currencies from different countries that we can later collectively settle to your bank accounts in any country we support.</li>
</ol>
<h2 id='example'>Example</h2>
<p>You can request a payment of 10 USD via mobile money airtel_ug.</p>

<ul>
<li>10 USD will be converted to UGX since airtel_ug holds only UGX accounts.</li>
<li>Depending on the country and provider, the client will be debited an equivalent slightly higher than the market rate value by the provider.</li>
<li>The provider(airtel_ug, bank) will decide how much they debit off the customer account at their rate that is slightly higher than the market rate in most case.
This is like same way banks decide how much to debit when processing with visa/mastercard.</li>
<li>However, Dusupay will credit the equivalent of 10 USD to your UGX merchant sub-account at market rate with no extra fx markup.</li>
</ul>
<h2 id='take-note'>Take Note</h2>
<ol>
<li><p>You will have to implemement a <a href="#webhooks-ipns">webhook/callback url</a> and add it to the merchant account settings
<br><br>
We will post all payments made through your merchant account to that url whenever the transaction status changes.</p></li>
<li><p>For some payments especially online banking, customers need to complete their payments from a web interface.
<br><br>
Therefore, in the request response, we will return a field called <code>payment_url</code> that contains a url that you will need to redirect the client for them to complete/approve the payment.
<br><br>
For payments that do not need to be completed from the web, the <code>payment_url</code> field will be empty</p></li>
</ol>
<h1 id='collection'>Collection</h1><h2 id='sample-request'>Sample Request</h2>
<p>Request payments at the comfort of your home currency.</p>

<ul>
<li>method/verb: POST</li>
<li>LiveEndpoint: POST: https://api.dusupay.com/v1/collections</li>
<li>SandboxEndpoint: POST: https://sandbox.dusupay.com/v1/collections </li>
<li>Header: &#39;content-type: application/json&#39;</li>
</ul>
<h3 id='sample-request-data'>Sample Request Data</h3><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w"> 
    </span><span class="s2">"api_key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pk_eridsdsde23e23e2. Get this from your merchant account settings"</span><span class="p">,</span><span class="w"> 
    </span><span class="s2">"currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"USD"</span><span class="p">,</span><span class="w"> 
    </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.2</span><span class="p">,</span><span class="w">
    </span><span class="s2">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MOBILE_MONEY/CARD/BANK/CRYPTO"</span><span class="p">,</span><span class="w"> 
    </span><span class="s2">"provider_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"e.g airtel_ug, mtn_ug. Get list of providers from the Providers API"</span><span class="p">,</span><span class="w"> 
    </span><span class="s2">"account_number"</span><span class="p">:</span><span class="w"> </span><span class="s2">"256777111000"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"merchant_reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Your payment reference"</span><span class="p">,</span><span class="w"> 
    </span><span class="s2">"narration"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Short Payment reason"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"redirect_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"optional. used for payments completed via payment_url returned "</span><span class="p">,</span><span class="w">
    </span><span class="s2">"account_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"optional"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"account_email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"optional"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"voucher"</span><span class="p">:</span><span class="w"> </span><span class="s2">"optional. Required for Ghana vodafone mobile money"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>api_key</td>
<td>string, required</td>
<td>Obtained from merchant account settings</td>
</tr>
<tr>
<td>currency</td>
<td>string, required</td>
<td>You can use your home currency when making requests. e.g USD <br><br>You will receive your funds at market rate into your merchant sub-account account.</td>
</tr>
<tr>
<td>amount</td>
<td>int/double, required</td>
<td>2 decimal places allowed for double.</td>
</tr>
<tr>
<td>method</td>
<td>string, required</td>
<td><code>MOBILE_MONEY</code>, <code>CARD</code>, <code>BANK</code>, <code>CRYPTO</code></td>
</tr>
<tr>
<td>provider_id</td>
<td>string, required</td>
<td>e.g <code>airtel_ug</code>, <code>mtn_ug</code>. Get list of providers from the <a href="#payment-options">Payment Options API</a></td>
</tr>
<tr>
<td>account_number</td>
<td>string, required for MOBILE_MONEY</td>
<td>Provide an internationally formatted number if the payment method is <code>MOBILE_MONEY</code> e.g 256777111777<br><br>It is not required for <code>CARD</code>, <code>BANK</code> and <code>CRYPTO</code> payment methods unless specified in the Exceptional Parameters that follow merchant_reference</td>
</tr>
<tr>
<td>narration</td>
<td>string, required, <code>4 to 64</code> characters</td>
<td>Use this to add a brief description or comment to the transaction.</td>
</tr>
<tr>
<td>redirect_url</td>
<td>string, optional for <code>MOBILE_MONEY</code></td>
<td>Required for <code>BANK</code>, <code>CARD</code> and  <code>CRYPTO</code> collections. <br><br>Used to redirect the client after a payment has been completed or canceled via the <code>payment_url</code> if returned in the request’s response.<br><br>When a request is made, a payment link is returned in the response if the payment needs to be completed by the client via the <code>payment_url</code> returned.<br><br>Some of the payment methods that would return a payment link include, online banking methods, visa 3d, and any other the require input via a web interface.</td>
</tr>
<tr>
<td>account_name</td>
<td>string, optional</td>
<td>Helps to easily lookup customer transactions.</td>
</tr>
<tr>
<td>account_email</td>
<td>string, optional</td>
<td>Used to email customer. Helps to easily lookup customer transactions.</td>
</tr>
</tbody></table>
<h2 id='special-parameters'>Special Parameters</h2>
<ul>
<li>Some networks or providers require extra data from the customer for the transaction to get processed.</li>
</ul>

<table><thead>
<tr>
<th>Network</th>
<th>Fields</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>GhanaMobileMoney<br>- <b>Vodafone</b></td>
<td>voucher</td>
<td>String. Customer should <b><code>dial *110#</code></b> to generate a transaction voucher and provide it prior to the request</td>
</tr>
</tbody></table>
<h2 id='sample-response'>Sample Response</h2><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">202</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"accepted"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Transaction Initiated"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">226</span><span class="p">,</span><span class="w">
    </span><span class="s2">"request_amount"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.2</span><span class="p">,</span><span class="w">
    </span><span class="s2">"request_currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"USD"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"account_amount"</span><span class="p">:</span><span class="w"> </span><span class="mf">737.9934</span><span class="p">,</span><span class="w">
    </span><span class="s2">"account_currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UGX"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"transaction_fee"</span><span class="p">:</span><span class="w"> </span><span class="mf">21.4018</span><span class="p">,</span><span class="w">
    </span><span class="s2">"total_credit"</span><span class="p">:</span><span class="w"> </span><span class="mf">716.5916</span><span class="p">,</span><span class="w">
    </span><span class="s2">"provider_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mtn_ug"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"merchant_reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"76859aae-f148-48c5-9901-2e474cf19b71"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"internal_reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DUSUPAY405GZM1G5JXGA71IK"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"transaction_status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PENDING"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"transaction_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"collection"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Transaction Initiated"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"customer_charged"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="s2">"payment_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"This only exists if the payment needs to be completed from a web browser."</span><span class="p">,</span><span class="w">
    </span><span class="s2">"instructions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"step_no"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Ensure that you have sufficient balance on your MTN Mobile Money account"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"step_no"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Approve the payment request sent to your phone"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="s2">"customer_charged"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<table><thead>
<tr>
<th>Parameters</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>request_amount</td>
<td>Amount requested for collection</td>
</tr>
<tr>
<td>request_currency</td>
<td>Currency of the request amount</td>
</tr>
<tr>
<td>account_amount</td>
<td>The converted amount from request_currency to account_currency at market rate.</td>
</tr>
<tr>
<td>account_currency</td>
<td>The sub-account/wallet currency in your merchant account where the amount paid by the customer will be deposited.<br><br>The currency of the amount paid by the customer is determined by the provider_id used to pay.</td>
</tr>
<tr>
<td>transaction_fee</td>
<td>This is the fee charged off the paid amount. Whether the merchant is charged or the customer, depending on your merchant setting, the fees will be included in this field.</td>
</tr>
<tr>
<td>total_credit</td>
<td>This is the amount less the transaction_fee deposited in your account.</td>
</tr>
<tr>
<td>provider_id</td>
<td>This is the provider the customer is expected to pay from</td>
</tr>
<tr>
<td>merchant_reference</td>
<td>This is the reference passed earlier in the request</td>
</tr>
<tr>
<td>internal_reference</td>
<td>This is our internal reference. Useful when dealing with transaction issues. Store it.</td>
</tr>
<tr>
<td>transaction_status</td>
<td>The status of the transaction</td>
</tr>
<tr>
<td>customer_charged</td>
<td>This indicates whether it’s the customer that was charged or not.<br><br>Under your merchant account settings, you can define whether we should charge you or the customer paying.</td>
</tr>
<tr>
<td>payment_url</td>
<td><code>Optional</code> This is a url where the customer should be redirect to complete the payment.<br><br>It&#39;s not mandatory for us to return a value for this field. It&#39;s only returned if the payment has to be completed from a web browser. <br><br>Therefore always redirect the user to it whenever it contains a url value otherwise tell the customer to approve the payment from their phone number if it&#39;s mobile money or inform them that their transaction is being processed. <br>Once we send you an <code>IPN</code> or <code>webhook data</code> to your <code>webhook/callback url</code>, you can then inform the customer that the payment has <code>completed</code> or <code>failed</code>.<br><br>This is common for online banking.</td>
</tr>
<tr>
<td>instructions</td>
<td><code>Optional</code> This is only returned where we see fit. This means it could be empty in the response. Whenever it&#39;s returned, Please ensure to show the instructions returned such that the customer is aware of what to do next. <br><br>This is mainly used for mobile money payments or requests that return an empty <code>payment_url</code>. <br><br> We recommend that you display the instructions to the customer as a pop-up modal or new screen with a button that leads them to another screen where they can view the current state of their transaction. <br>This will initally be Pending/Processing and once we notify you that the transaction has completed or failed, you can can show it to the customer with the appropriate message returned from our api data.</td>
</tr>
</tbody></table>
<h2 id='card-payments'>Card Payments</h2>
<ul>
<li><code>CARD</code> should be passed as the method.</li>
<li>A <code>payment_url</code> will be returned which you will redirect the customer to complete the payment</li>
<li><code>redirect_url</code> should be passed too. This is where the customer will be redirected after the payment has completed or been cancelled</li>
</ul>
<h3 id='local-cards'>Local Cards</h3>
<ul>
<li>Only local cards of a given country are supported.</li>
<li>Not all countries have this option available.</li>
<li>This option will require a customer to provide their card pin for the payment to be processed in the webview/browser</li>
</ul>

<table><thead>
<tr>
<th>provider_id</th>
<th>description</th>
</tr>
</thead><tbody>
<tr>
<td>local_ngn</td>
<td>Local Mastercard/Verve Nigeria</td>
</tr>
</tbody></table>
<h3 id='international-cards'>International Cards</h3>
<ul>
<li>Only 3D enabled cards with online banking can be used for this option.</li>
<li>For each country that we have allowed international card payments, sample provider_id codes would look like below;</li>
</ul>

<table><thead>
<tr>
<th>provider_id</th>
<th>description</th>
</tr>
</thead><tbody>
<tr>
<td>international_usd</td>
<td>3D card payments to collect USD</td>
</tr>
<tr>
<td>international_ugx</td>
<td>3D card payments to collect UGX</td>
</tr>
<tr>
<td>international_kes</td>
<td>3D card payments to collect KES</td>
</tr>
<tr>
<td>…</td>
<td>…</td>
</tr>
</tbody></table>

<ul>
<li>Use the <a href="#payment-options">payment options api</a> to get per country card options</li>
</ul>
<h2 id='crypto-payments'>Crypto Payments</h2>
<ul>
<li><code>CRYPTO</code> should be passed as the method.</li>
<li>A <code>payment_url</code> will be returned which you will redirect the customer to complete the payment</li>
<li><code>redirect_url</code> should be passed too. This is where the customer will be redirected after the payment has completed or been cancelled</li>
</ul>

<table><thead>
<tr>
<th>provider_id</th>
<th>description</th>
</tr>
</thead><tbody>
<tr>
<td>btc_usd</td>
<td>Crypto payments to collect USD</td>
</tr>
<tr>
<td>btc_eur</td>
<td>Crypto payments to collect EUR</td>
</tr>
<tr>
<td>btc_gbp</td>
<td>Crypto payments to collect GBP</td>
</tr>
</tbody></table>

<ul>
<li>Use the <a href="#payment-options">payment options api</a> to get per country crypto options</li>
</ul>
<h2 id='redirect-url'>Redirect URL</h2><h3 id='description'>Description</h3>
<ul>
<li><code>BANK</code>, <code>CARD</code> and <code>CRYPTO</code> payment options are processed from the browser or webview.</li>
<li>A <code>redirect_url</code> needs to be provided when making a collection request.</li>
<li>When a customer completes, cancels or fails to make a payment, they will be redirected to the <code>redirect_url</code> that was passed.</li>
</ul>
<h4 id='nb'>NB</h4>
<ul>
<li>The data included in <code>redirect_url</code> are subject to change by the customer,
therefore, only rely on the <a href="#webhooks">webhook’s</a> information to give value to the customer.
Redirect Data</li>
</ul>
<h2 id='redirect-data'>Redirect Data</h2>
<p>-<code>GET</code> parameters such as below will be attached to the redirect url;</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>reference</td>
<td>This is your merchant transaction reference</td>
</tr>
<tr>
<td>status</td>
<td>Transaction status</td>
</tr>
<tr>
<td>message</td>
<td>Response message.</td>
</tr>
</tbody></table>
<h2 id='direct-card-collections'>Direct Card Collections</h2>
<p>We support direct card collection requests. This means that as a merchant, you can create a payment form on your interface and then send the card details to the API to process the payment. 
<br><br>
Card data is not sent in plain text but rather as an encrypted string. On the right, is a sample JSON template for the direct card collection request</p>
<h3 id='request-data'>Request Data</h3><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"api_key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PUBK-***"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"USD"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
    </span><span class="s2">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CARD"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"provider_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"international_usd"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"account_number"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
    </span><span class="s2">"merchant_reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"unique_ref"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"narration"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Direct Collection Request"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"redirect_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://redirect-url"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"card_cipher"</span><span class="p">:</span><span class="w"> </span><span class="s2">"encrypted-string"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<ul>
<li>Request data is as seen on the right</li>
</ul>
<h4 id='note'>NOTE:</h4>
<ul>
<li>The parameter <b><code>**card_cipher**</code></b> holds the encrypted card details. </li>
</ul>
<h3 id='encryption'>ENCRYPTION</h3><h4 id='step-1-organise-card-details-in-json'>STEP 1 - Organise Card Details in json</h4>
<ul>
<li>A JSON string with data keys like those shown in the sample on the right should be created.</li>
</ul>
<h5 id='card-details'>Card Details</h5>
<ul>
<li>The card details should be included in a json object which will be encryted to generate the data for the <code>card_cipher</code> parameter when making a card collection request.</li>
</ul>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"full_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"John Doe"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"card_no"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0123456789123456"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"exp_month"</span><span class="p">:</span><span class="w"> </span><span class="s2">"06"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"exp_year"</span><span class="p">:</span><span class="w"> </span><span class="s2">"22"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"cvv"</span><span class="p">:</span><span class="w"> </span><span class="s2">"123"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"pin"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1234"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"billing_address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Second Street"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"billing_city"</span><span class="p">:</span><span class="w"> </span><span class="s2">"San Francisco"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"billing_zip"</span><span class="p">:</span><span class="w"> </span><span class="s2">"94105"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"billing_state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CA"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"billing_country"</span><span class="p">:</span><span class="w"> </span><span class="s2">"US"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><pre class="highlight shell tab-shell"><code><span class="c"># Check the Js/Json tab for a sample card detail object </span>
<span class="c"># meant to be encrypted as the card_cipher parameter value</span>










<span class="c">#</span>
</code></pre><pre class="highlight javascript tab-javascript"><code><span class="c1">// Check the Js/Json tab for a sample card detail object </span>
<span class="c1">// meant to be encrypted as the card_cipher parameter value</span>










<span class="c1">//</span>
</code></pre><pre class="highlight php tab-php"><code># Check the Js/Json tab for a sample card detail object 
# meant to be encrypted as the card_cipher parameter value










#
</code></pre>
<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>full_name</td>
<td>string, required</td>
<td>The full name of the card holder as registered by the issuer</td>
</tr>
<tr>
<td>card_no</td>
<td>string, required</td>
<td>The card number. Usually length of 16 to 19</td>
</tr>
<tr>
<td>exp_month</td>
<td>string, required</td>
<td>The card expiry month. For single digit months, prefix 0 e.g. <code>06</code></td>
</tr>
<tr>
<td>exp_year</td>
<td>string, required</td>
<td>The card expiry year</td>
</tr>
<tr>
<td>cvv</td>
<td>string, required</td>
<td>The card CVV, CVC etc depending on the nature of the card</td>
</tr>
<tr>
<td>pin</td>
<td>string, optional</td>
<td>Optional parameter, only required for locally issued Nigerian Verve cards</td>
</tr>
<tr>
<td>billing_address</td>
<td>string, optional</td>
<td>Billing address as registered by the issuer. Required for cards issued in USA, Canada and Europe</td>
</tr>
<tr>
<td>billing_city</td>
<td>string, optional</td>
<td>Billing city name as registered by the issuer. Required for cards issued in USA, Canada and Europe</td>
</tr>
<tr>
<td>billing_zip</td>
<td>string, optional</td>
<td>The zip/postal code. Required for cards issued in USA, Canada and Europe</td>
</tr>
<tr>
<td>billing_state</td>
<td>string, optional</td>
<td>State name. Required for cards issued in USA, Canada and Europe</td>
</tr>
<tr>
<td>billing_country</td>
<td>string, optional</td>
<td>The 2 character ISO country code. Required for cards issued in USA, Canada and Europe. The country code list can be obtained from the API endpoint below.</td>
</tr>
</tbody></table>
<h4 id='step-2-encrypt-the-json'>STEP 2 - Encrypt the JSON</h4>
<ul>
<li>Check the samples from the NodeJS and PHP sample tabs</li>
</ul>
<h5 id='note-2'>NOTE</h5>
<ul>
<li>First Download the public key using the <a href="#get-download-the-public-key">API here</a> and store it in a text file named <code>dusupay.public.key.pem</code>. This will be needed </li>
</ul>
<pre class="highlight json tab-json"><code><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">Check</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">samples</span><span class="w"> </span><span class="err">from</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">NodeJS</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">PHP</span><span class="w"> </span><span class="err">sample</span><span class="w"> </span><span class="err">tabs</span><span class="w">
 </span><span class="err">//</span><span class="w"> </span><span class="err">on</span><span class="w"> </span><span class="err">how</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">encrypt</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">card</span><span class="w"> </span><span class="err">details</span><span class="w">




























</span><span class="err">//</span><span class="w">
</span></code></pre><pre class="highlight shell tab-shell"><code><span class="c"># Check the samples from the NodeJS and PHP sample tabs</span>
<span class="c"># on how to encrypt the card details</span>




























<span class="c">#</span>
</code></pre><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">crypto</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'crypto'</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'fs'</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">full_name</span><span class="p">:</span> <span class="s2">"John Doe"</span><span class="p">,</span>
        <span class="na">card_no</span><span class="p">:</span> <span class="s2">"0123456789123456"</span><span class="p">,</span>
        <span class="na">exp_month</span><span class="p">:</span> <span class="s2">"06"</span><span class="p">,</span>
        <span class="na">exp_year</span><span class="p">:</span> <span class="s2">"22"</span><span class="p">,</span>
        <span class="na">cvv</span><span class="p">:</span> <span class="s2">"123"</span>
    <span class="p">};</span>

<span class="kd">function</span> <span class="nx">encryptData</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">payload</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="kr">const</span> <span class="nx">publicKeyFile</span> <span class="o">=</span> <span class="s2">"path-to-file/dusupay.public.key.pem"</span><span class="p">;</span>
    <span class="kr">const</span> <span class="nx">publicKey</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">publicKeyFile</span><span class="p">).</span><span class="nx">toString</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/</span><span class="se">\\</span><span class="sr">n/g</span><span class="p">,</span> <span class="s1">'\n'</span><span class="p">);</span>

    <span class="kr">const</span> <span class="nx">encryptedData</span> <span class="o">=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">publicEncrypt</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="na">key</span><span class="p">:</span> <span class="nx">publicKey</span><span class="p">,</span>
            <span class="na">padding</span><span class="p">:</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">constants</span><span class="p">.</span><span class="nx">RSA_PKCS1_PADDING</span>
        <span class="p">},</span>
        <span class="nx">Buffer</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="nx">payload</span><span class="p">)</span>
    <span class="p">);</span>

    <span class="cm">/*return the base64 encoded version of the encrypted string*/</span>
    <span class="k">return</span> <span class="nx">encryptedData</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s2">"base64"</span><span class="p">);</span>
<span class="p">}</span>

</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>

<span class="k">public</span> <span class="k">function</span> <span class="nf">encryptData</span><span class="p">(</span><span class="nv">$jsonString</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$file</span> <span class="o">=</span> <span class="s2">"path-to-file/dusupay.public.key.pem"</span><span class="p">;</span>
    <span class="nv">$keyContent</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
    <span class="nv">$publicKey</span> <span class="o">=</span> <span class="nb">openssl_get_publickey</span><span class="p">(</span><span class="nv">$keyContent</span><span class="p">);</span>
    <span class="nv">$ret</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">openssl_public_encrypt</span><span class="p">(</span><span class="nv">$jsonString</span><span class="p">,</span> <span class="nv">$result</span><span class="p">,</span> <span class="nv">$publicKey</span><span class="p">,</span> <span class="nx">OPENSSL_PKCS1_PADDING</span><span class="p">))</span> <span class="p">{</span>
        <span class="cm">/*get the base64 encoded version of the encrypted string*/</span>
        <span class="nv">$ret</span> <span class="o">=</span> <span class="nb">base64_encode</span><span class="p">(</span><span class="s1">''</span> <span class="o">.</span> <span class="nv">$result</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span>













#
</code></pre><h2 id='get-list-of-verification-countries'>GET List of verification countries</h2>
<ul>
<li>To get a list of the countries to include in the <code>billing_country</code> parameter accordingly, use the api describe on the right. Sample curl/shell request is included.</li>
</ul>
<pre class="highlight json tab-json"><code><span class="err">Request</span><span class="p">:</span><span class="w"> </span><span class="err">GET</span><span class="p">:</span><span class="w"> </span><span class="err">https</span><span class="p">:</span><span class="err">//api.dusupay.com/v</span><span class="mi">1</span><span class="err">/avs-countries?api_key=PUBK-***</span><span class="w">
</span><span class="err">Header</span><span class="p">:</span><span class="w"> </span><span class="err">'secret-key</span><span class="p">:</span><span class="w"> </span><span class="err">SECK-***'</span><span class="w">

</span><span class="err">//</span><span class="w"> </span><span class="err">Check</span><span class="w"> </span><span class="err">under</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">shell</span><span class="w"> </span><span class="err">sample</span><span class="w"> </span><span class="err">tab</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">CURL</span><span class="w"> </span><span class="err">example</span><span class="w">
</span><span class="err">//</span><span class="w"> </span><span class="err">on</span><span class="w"> </span><span class="err">how</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">GET</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">list</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">veirification</span><span class="w"> </span><span class="err">countries</span><span class="w">
</span></code></pre><pre class="highlight shell tab-shell"><code>curl -v -X GET <span class="s1">'https://api.dusupay.com/v1/avs-countries?api_key=PUBK-***'</span> -H <span class="s1">'secret-key: SECK-***'</span>



<span class="c">#</span>
</code></pre><pre class="highlight javascript tab-javascript"><code><span class="c1">// Check under the shell sample tab for CURL example</span>
<span class="c1">// on how to GET the list of veirification countries</span>


<span class="c1">//</span>
</code></pre><pre class="highlight php tab-php"><code>// Check under the shell sample tab for CURL example
// on how to GET the list of veirification countries



//
</code></pre><h2 id='get-download-the-public-key'>GET/Download the public key</h2>
<ul>
<li>The contents can be stored in a text file and named <code>dusupay.public.key.pem</code> which will be needed to encrypt the data.</li>
</ul>
<pre class="highlight json tab-json"><code><span class="err">Request</span><span class="p">:</span><span class="w"> </span><span class="err">GET</span><span class="p">:</span><span class="w"> </span><span class="err">https</span><span class="p">:</span><span class="err">//api.dusupay.com/v</span><span class="mi">1</span><span class="err">/download-public-key?api_key=PUBK-***</span><span class="w">
</span><span class="err">Header</span><span class="p">:</span><span class="w"> </span><span class="err">'secret-key</span><span class="p">:</span><span class="w"> </span><span class="err">SECK-***'</span><span class="w">

</span><span class="err">//</span><span class="w"> </span><span class="err">Check</span><span class="w"> </span><span class="err">under</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">shell</span><span class="w"> </span><span class="err">sample</span><span class="w"> </span><span class="err">tab</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">CURL</span><span class="w"> </span><span class="err">example</span><span class="w"> 
</span><span class="err">//</span><span class="w"> </span><span class="err">on</span><span class="w"> </span><span class="err">how</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">Download</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">public</span><span class="w"> </span><span class="err">key</span><span class="w">
</span></code></pre><pre class="highlight shell tab-shell"><code>curl -v -X GET <span class="s1">'https://api.dusupay.com/v1/download-public-key?api_key=PUBK-***'</span> -H <span class="s1">'secret-key: SECK-***'</span>



<span class="c">#</span>
</code></pre><pre class="highlight javascript tab-javascript"><code><span class="c1">// Check under the shell sample tab for CURL example</span>
<span class="c1">// on how to Download the public key</span>


<span class="c1">//</span>
</code></pre><pre class="highlight php tab-php"><code>// Check under the shell sample tab for CURL example
// on how to Download the public key


//
</code></pre><h1 id='sending-money'>Sending Money</h1><h1 id='introduction'>Introduction</h1><h2 id='how-it-work'>How it work</h2>
<ul>
<li>With dusupay, Money is sent to either a customer’s mobile money wallet or bank supported.</li>
<li>We will debit the equivalent local currency amount supported by the provider at market rate.</li>
<li>Funds received by the customer account depend on the provider rate so they will receive funds less than those at market rate.</li>
</ul>
<h1 id='payout'>Payout</h1><h2 id='sample-request'>Sample Request</h2>
<p>Request payments at the comfort of your home currency.</p>

<ul>
<li>content-type: application/json</li>
<li>endpoint: /v1/payouts</li>
<li>method/verb: POST</li>
</ul>
<h3 id='request-headers'>Request Headers</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Examples</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>secret-key</td>
<td>SECK3298j923</td>
<td>Use your merchant account secret key</td>
</tr>
</tbody></table>
<pre class="highlight ruby tab-ruby"><code><span class="no">POST</span><span class="p">:</span> <span class="n">https</span><span class="ss">:/</span><span class="o">/</span><span class="n">api</span><span class="p">.</span><span class="nf">dusupay</span><span class="p">.</span><span class="nf">com</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">payouts</span>
</code></pre><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"api_key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PUBK-24b72aebb821aea177483039677df9d3"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"USD"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.2</span><span class="p">,</span><span class="w">
    </span><span class="s2">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MOBILE_MONEY"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"provider_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mtn_ug"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"account_number"</span><span class="p">:</span><span class="w"> </span><span class="s2">"256777044237"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"account_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Hillary Namanya"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"account_email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"optional@email.com"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"merchant_reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AdIVeSAdeLEsta"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"narration"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Hospital Bill"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><h3 id='request-parameters'>Request Parameters</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>api_key</td>
<td>string, required</td>
<td>Obtained from merchant account settings</td>
</tr>
<tr>
<td>currency</td>
<td>string, required</td>
<td>You can use your home currency when making requests. e.g USD<br><br>You will receive your funds at market rate into your merchant sub-account account.</td>
</tr>
<tr>
<td>amount</td>
<td>int/double, required</td>
<td>2 decimal places allowed for double.</td>
</tr>
<tr>
<td>method</td>
<td>string, required</td>
<td><code>MOBILE_MONEY</code>, <code>BANK</code></td>
</tr>
<tr>
<td>provider_id</td>
<td>string, required</td>
<td>e.g <code>airtel_ug</code>, <code>mtn_ug</code>. Get list of providers from the <a href="#payment-options">Payment Options API</a></td>
</tr>
<tr>
<td>account_number</td>
<td>string, required</td>
<td>Internationally formatted number required if method is <code>MOBILE_MONEY</code> <br><br> For European,UK,Germany bank payouts, set <code>account_number</code> to contain the IBAN</td>
</tr>
<tr>
<td>account_name</td>
<td>string, required</td>
<td>The name of the customer’s account</td>
</tr>
<tr>
<td>account_email</td>
<td>string, optional</td>
<td>The email address of the customer</td>
</tr>
<tr>
<td>merchant_reference</td>
<td>string, required, <code>4 to 36</code> characters</td>
<td>This is a unique transaction reference generated by your system.<br><br>You can try using <a href="https://www.uuidgenerator.net/">UUID version 4</a>.</td>
</tr>
<tr>
<td>narration</td>
<td>string, required, <code>4 to 64</code> characters</td>
<td>Use this to add a brief description or comment to the transaction.</td>
</tr>
<tr>
<td>extra_params</td>
<td>Object, optional</td>
<td>This field is mainly used to pass data that applies to specific payout methods or providers that follow below</td>
</tr>
</tbody></table>
<h2 id='extra-parameters'>Extra parameters</h2><h3 id='description'>Description</h3>
<ul>
<li>Different countries require different extra information to send money to customer’s accounts correctly.</li>
</ul>
<pre class="highlight ruby tab-ruby"><code><span class="no">Example</span> <span class="n">payout</span> <span class="n">with</span> <span class="n">extra</span> <span class="n">parameters</span>
</code></pre><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"api_key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PUBK-5678g7ytrd7uyu8guyyj"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"USD"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.2</span><span class="p">,</span><span class="w">
    </span><span class="s2">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BANK"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"provider_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bank_gh"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"account_number"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1000909898989"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"account_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Hillary Namanya"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"account_email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"optional@email.com"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"merchant_reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AdIVeSAdeLEsta"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"narration"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Hospital Bill"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"extra_params"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"bank_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"6876132"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"branch_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7898"</span><span class="w">
    </span><span class="p">},</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<ul>
<li>Below are some of the fields per country that are required to be included in the <code>extra_params</code> field when making a payout request.</li>
</ul>

<table><thead>
<tr>
<th>Method</th>
<th>Extra fields</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>Uganda<br> - BANK</td>
<td>bank_code</td>
<td>The Bank code of Ugandan Bank</td>
</tr>
<tr>
<td>Kenya<br> - BANK</td>
<td>bank_code</td>
<td>The Bank code of Kenyan Bank</td>
</tr>
<tr>
<td>Tanzania<br> - BANK</td>
<td>bank_code</td>
<td>The Bank code of Tanzanian Bank</td>
</tr>
<tr>
<td>Nigeria<br> - BANK</td>
<td>bank_code</td>
<td>The Bank code of Nigeria Bank</td>
</tr>
<tr>
<td>Ghana<br> - BANK</td>
<td>bank_code</td>
<td>The Bank code of Ghanaian Bank</td>
</tr>
<tr>
<td></td>
<td>branch_code</td>
<td>The Branch code of Ghanaian Bank. Required for GHS<br><br>An api to get Branch Codes can be found <a href="#bank-branches-api">here</a>.</td>
</tr>
<tr>
<td>USA<br> - BANK</td>
<td>routing_number</td>
<td>Bank Routing number</td>
</tr>
<tr>
<td></td>
<td>swift_code</td>
<td>Bank Swiftcode</td>
</tr>
<tr>
<td></td>
<td>bank_name</td>
<td>Bank Name e.g (BANK OF AMERICA)</td>
</tr>
<tr>
<td></td>
<td>beneficiary_address</td>
<td>e.g San Francisco, 4 Newton</td>
</tr>
<tr>
<td>Europe<br> - BANK</td>
<td>bank_code</td>
<td>Bank code provided by the <a href="#payment-options">payment options api</a> e.g bank_fr (for France), bank_de (for Germany)</td>
</tr>
<tr>
<td></td>
<td>routing_number</td>
<td>The swift code can be used here</td>
</tr>
<tr>
<td></td>
<td>swift_code</td>
<td>Bank Swiftcode</td>
</tr>
<tr>
<td></td>
<td>postal_code</td>
<td>Beneficiary postal code e.g 80489</td>
</tr>
<tr>
<td></td>
<td>street_number</td>
<td>e.g 31</td>
</tr>
<tr>
<td></td>
<td>street_name</td>
<td>e.g Handelsbank Elsenheimer St</td>
</tr>
<tr>
<td></td>
<td>city</td>
<td>e.g Munchen</td>
</tr>
<tr>
<td></td>
<td>bank_name</td>
<td>Bank Name e.g (LLOYDS BANK)</td>
</tr>
<tr>
<td>U.K<br> - BANK</td>
<td>routing_number</td>
<td>The swift code can be used here</td>
</tr>
<tr>
<td></td>
<td>swift_code</td>
<td>Bank Swiftcode</td>
</tr>
<tr>
<td></td>
<td>postal_code</td>
<td>Beneficiary postal code e.g 80489</td>
</tr>
<tr>
<td></td>
<td>street_number</td>
<td>e.g 31</td>
</tr>
<tr>
<td></td>
<td>street_name</td>
<td>e.g Handelsbank Elsenheimer St</td>
</tr>
<tr>
<td></td>
<td>city</td>
<td>e.g Munchen</td>
</tr>
<tr>
<td></td>
<td>bank_name</td>
<td>Bank Name e.g (LLOYDS BANK)</td>
</tr>
<tr>
<td></td>
<td>bank_code</td>
<td>Bank code provided by the <a href="#payment-options">payment options api</a> e.g bank_at (for Australia), bank_be (for Belgium)</td>
</tr>
</tbody></table>
<h4 id='nb'>NB</h4>
<ul>
<li>For European,UK,Germany bank payouts, set <code>account_number</code> to contain the IBAN</li>
</ul>
<h1 id='miscellaneous'>Miscellaneous</h1><h1 id='transaction-statuses'>Transaction Statuses</h1>
<table><thead>
<tr>
<th>Status</th>
<th>Reason</th>
</tr>
</thead><tbody>
<tr>
<td>PENDING</td>
<td>When a payment is waiting for processing.</td>
</tr>
<tr>
<td>FAILED</td>
<td>When a payment failed</td>
</tr>
<tr>
<td>COMPLETED</td>
<td>When a payment completed</td>
</tr>
<tr>
<td>CANCELLED</td>
<td>When a customer cancelled a payment</td>
</tr>
</tbody></table>
<h1 id='webhooks-ipns'>Webhooks/IPNs</h1>
<ol>
<li>All <code>collection</code> and <code>payout</code> transaction <code>callbacks</code> will be sent to the url
set as the <code>webhook url</code> under your merchant account settings.<br><br></li>
<li>A <b><code>POST</code></b> request with <b><code>json data</code></b> will be sent to your <code>webhook url</code><br><br></li>
<li>We require that you provide a secure <code>webhook url</code>.
Therefore only <code>https</code> urls can be set or called-back.</li>
</ol>
<h2 id='setting-webhook'>Setting webhook</h2>
<ol>
<li>Click the edit button under Api Settings of the merchant account settings.</li>
<li>Set the Webhook URL field with your webhook URL</li>
</ol>
<h2 id='calling-webhook'>Calling webhook</h2>
<ol>
<li>We will call your webhook url whenever the transaction status changes.
<br><br></li>
<li>You will need to acknowledge receipt of the callback by responding with http status code <b><code>200</code></b>.
Otherwise we will keep calling your endpoint at an interval of 10 minutes for 3 days.</li>
</ol>
<h2 id='accepting-webhook'>Accepting webhook</h2>
<ol>
<li>To ensure that the callback data sent to your <code>webhook URL</code> comes from our servers, you need to set a <code>callback hash</code> under the <code>Api Settings</code>.
<br><br></li>
<li>We will include a header called <code>webhook-hash</code> in the request sent to the callback url.
e.g <b>&quot;webhook-hash: XXXX&quot;</b>
<br><br></li>
<li><p>You should check to make sure the <code>webhook-hash</code> we sent matches what was set under your merchant account before giving value to the customer.</p></li>
<li><p>We <code>do not</code> generate or provide you the <code>webhook hash</code>. You are expected to simply generate a random string that cannot be guessed and use it as the webhook hash value wherever needed.</p></li>
</ol>
<h2 id='responding-to-webhooks'>Responding to webhooks</h2>
<ul>
<li>We will stop calling you back if your callback url responds with “http status codes” below;</li>
</ul>

<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>200</code></td>
<td>- OK</td>
</tr>
<tr>
<td><code>400</code></td>
<td>- Bad Request</td>
</tr>
<tr>
<td><code>401</code></td>
<td>- Unauthorised</td>
</tr>
<tr>
<td><code>403</code></td>
<td>- Forbidden</td>
</tr>
<tr>
<td><code>422</code></td>
<td>- Unprocessable entity.</td>
</tr>
</tbody></table>
<h2 id='rejecting-webhook'>Rejecting webhook</h2>
<ul>
<li>In a scenario where the transaction cannot be processed or you cannot give value, respond with http codes below;</li>
</ul>

<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>400</code></td>
<td>- Bad Request. <br>- e.g when there’s a missing parameter</td>
</tr>
<tr>
<td><code>422</code></td>
<td>- Unprocessable entity. <br>- e.g when the request is fine but you cannot complete it because the amount does not match what you expected.</td>
</tr>
</tbody></table>
<h2 id='note'>Note</h2>
<ul>
<li>Always verify the <code>amount</code> to make sure it matches what is meant to be <code>paid</code>.</li>
</ul>
<h2 id='sample-collection-ipn-data'>Sample Collection IPN Data</h2><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">226</span><span class="p">,</span><span class="w">
    </span><span class="s2">"request_amount"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.2</span><span class="p">,</span><span class="w">
    </span><span class="s2">"request_currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"USD"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"account_amount"</span><span class="p">:</span><span class="w"> </span><span class="mf">737.9934</span><span class="p">,</span><span class="w">
    </span><span class="s2">"account_currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UGX"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"transaction_fee"</span><span class="p">:</span><span class="w"> </span><span class="mf">21.4018</span><span class="p">,</span><span class="w">
    </span><span class="s2">"total_credit"</span><span class="p">:</span><span class="w"> </span><span class="mf">716.5916</span><span class="p">,</span><span class="w">
    </span><span class="s2">"customer_charged"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="s2">"provider_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mtn_ug"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"merchant_reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"76859aae-f148-48c5-9901-2e474cf19b71"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"internal_reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DUSUPAY405GZM1G5JXGA71IK"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"transaction_status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"COMPLETED"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"transaction_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"collection"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Transaction Completed Successfully"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"account_number"</span><span class="p">:</span><span class="w"> </span><span class="s2">"256777111786 - Optional"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"account_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"- Optional"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"institution_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MTN Mobile Money - Optional"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><h3 id='note-2'>Note</h3>
<ul>
<li>field <b><code>total_credit</code></b> is returned in a collection IPN only</li>
<li>field <b><code>customer_charged</code></b> is returned in a collection IPN only</li>
<li>field <b><code>account_number</code></b> is empty if we do not have the account number</li>
<li>field <b><code>account_name</code></b> is empty if we do not have the account name</li>
<li>field <b><code>institution_name</code></b> is empty if we do not have the institute name</li>
</ul>
<h2 id='sample-payout-ipn-data'>Sample Payout IPN Data</h2><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">226</span><span class="p">,</span><span class="w">
    </span><span class="s2">"request_amount"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.2</span><span class="p">,</span><span class="w">
    </span><span class="s2">"request_currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"USD"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"account_amount"</span><span class="p">:</span><span class="w"> </span><span class="mf">737.9934</span><span class="p">,</span><span class="w">
    </span><span class="s2">"account_currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UGX"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"transaction_fee"</span><span class="p">:</span><span class="w"> </span><span class="mf">21.4018</span><span class="p">,</span><span class="w">
    </span><span class="s2">"total_debit"</span><span class="p">:</span><span class="w"> </span><span class="mf">716.5916</span><span class="p">,</span><span class="w">
    </span><span class="s2">"provider_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mtn_ug"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"merchant_reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"76859aae-f148-48c5-9901-2e474cf19b71"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"internal_reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DUSUPAY405GZM1G5JXGA71IK"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"transaction_status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"COMPLETED"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"transaction_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"payout"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Transaction Completed Successfully"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"account_number"</span><span class="p">:</span><span class="w"> </span><span class="s2">"256777111786 - Optional"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"account_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"- Optional"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"institution_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MTN Mobile Money - Optional"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><h3 id='take-note'>Take note</h3>
<ul>
<li>field <b><code>total_debit</code></b> is returned in a payout/refund IPN only</li>
<li>field <b><code>customer_charged</code></b> is <b><code>NOT</code></b> returned in a payout IPN only</li>
<li>field <b><code>account_number</code></b> is empty if we do not have the account number</li>
<li>field <b><code>account_name</code></b> is empty if we do not have the account name</li>
<li>field <b><code>institution_name</code></b> is empty if we do not have the institute name</li>
</ul>
<h2 id='sample-refund-ipn-data'>Sample Refund IPN Data</h2><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">65205</span><span class="p">,</span><span class="w">
    </span><span class="s2">"refund_amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">1054</span><span class="p">,</span><span class="w">
    </span><span class="s2">"refund_currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UGX"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"transaction_fee"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="s2">"total_debit"</span><span class="p">:</span><span class="w"> </span><span class="mi">1054</span><span class="p">,</span><span class="w">
    </span><span class="s2">"provider_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"international_ugx"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"collection_reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DUSUPAYXYXYXYXYXYXYXYXYX"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"internal_reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"RFD-DUSUPAYXYXYXYXYXYXYXYXYX-3486003"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"transaction_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"refund"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"transaction_status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"COMPLETED"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"account_number"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4860610032773134"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Refund Processed Successfully"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><h2 id='callback-signature-verification-optional'>Callback Signature Verification (Optional)</h2><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">226</span><span class="p">,</span><span class="w">
    </span><span class="s2">"request_amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
    </span><span class="s2">"request_currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"USD"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"account_amount"</span><span class="p">:</span><span class="w"> </span><span class="mf">737.9934</span><span class="p">,</span><span class="w">
    </span><span class="s2">"account_currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UGX"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"transaction_fee"</span><span class="p">:</span><span class="w"> </span><span class="mf">21.4018</span><span class="p">,</span><span class="w">
    </span><span class="s2">"total_credit"</span><span class="p">:</span><span class="w"> </span><span class="mf">716.5916</span><span class="p">,</span><span class="w">
    </span><span class="s2">"customer_charged"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="s2">"provider_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mtn_ug"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"merchant_reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"76859aae-f148-48c5-9901-2e474cf19b71"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"internal_reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DUSUPAY405GZM1G5JXGA71IK"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"transaction_status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"COMPLETED"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"transaction_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"collection"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Transaction Completed Successfully"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<ul>
<li>In addition to the <code>webhook-hash</code> header when calling back, there&#39;s another header with the name <code>dusupay-signature</code> and this is to help merchants trust that the callbacks originate from the DusuPay servers. Signature verification can be done with the following procedure;</li>
</ul>

<ol>
<li><p>Retrieve the value of the <code>dusupay-signature</code> header.</p></li>
<li><p>Form the string payload to be used in signature verification. This is obtained by concatenating values of the callback data in the format that follows
<br><br><code>id:internal_reference:transaction_status:callback_url</code> 
<br><br>where <strong>callback_url</strong> is the full URL as added to your merchant account settings. <br>
<br>The other values are obtained from the callback data. e.g. assume the following is the callback data and that the callback URL is<br> <code>https://www.sample-url.com/callback</code>
<br><br>The string payload would therefore be <br><code>226:DUSUPAY405GZM1G5JXGA71IK:COMPLETED:https://www.sample-url.com/callback</code></p></li>
<li><p>Obtain the public key as described in the previous section and store it as a file.</p></li>
<li><p>Use the public key to verify the signature as described in the example source codes below;</p></li>
</ol>
<h3 id='signature-verification-code-samples'>Signature Verification Code Samples</h3>
<ul>
<li>Signature Verification samples are as seen in the code samples on the right</li>
</ul>
<pre class="highlight json tab-json"><code><span class="err">//</span><span class="w"> </span><span class="err">Check</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">samples</span><span class="w"> </span><span class="err">from</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">NodeJS</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">PHP</span><span class="w"> </span><span class="err">sample</span><span class="w"> </span><span class="err">tabs</span><span class="w">
</span><span class="err">//</span><span class="w"> </span><span class="err">on</span><span class="w"> </span><span class="err">how</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">validate</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">signature</span><span class="w">


















</span></code></pre><pre class="highlight shell tab-shell"><code><span class="c"># Check the samples from the NodeJS and PHP sample tabs</span>
<span class="c"># on how to validate the signature</span>



















</code></pre><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">crypto</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'crypto'</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'fs'</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">isValidSignature</span><span class="p">()</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">strPayload</span> <span class="o">=</span> <span class="s2">"226:DUSUPAY405GZM1G5JXGA71IK:COMPLETED:https://www.sample-url.com/callback"</span><span class="p">;</span>
    <span class="kr">const</span> <span class="nx">signature</span> <span class="o">=</span> <span class="s2">"value-of-dusupay-signature"</span><span class="p">;</span>
    <span class="kr">const</span> <span class="nx">publicKeyFile</span> <span class="o">=</span> <span class="s2">"path-to-file/dusupay.public.key.pem"</span><span class="p">;</span>
    <span class="kr">const</span> <span class="nx">publicKey</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">publicKeyFile</span><span class="p">).</span><span class="nx">toString</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/</span><span class="se">\\</span><span class="sr">n/g</span><span class="p">,</span> <span class="s1">'\n'</span><span class="p">);</span>

    <span class="kr">const</span> <span class="nx">verify</span> <span class="o">=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">createVerify</span><span class="p">(</span><span class="s2">"SHA512"</span><span class="p">);</span>
    <span class="nx">verify</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">strPayload</span><span class="p">);</span>
    <span class="nx">verify</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>

    <span class="cm">/*true or false*/</span>
    <span class="k">return</span> <span class="nx">verify</span><span class="p">.</span><span class="nx">verify</span><span class="p">(</span><span class="nx">publicKey</span><span class="p">,</span> <span class="nx">signature</span><span class="p">,</span> <span class="s1">'base64'</span><span class="p">);</span>
<span class="p">}</span>

</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>

<span class="k">public</span> <span class="k">function</span> <span class="nf">isValidSignature</span><span class="p">()</span> <span class="p">{</span>
    <span class="nv">$file</span> <span class="o">=</span> <span class="s2">"path-to-file/dusupay.public.key.pem"</span><span class="p">;</span>
    <span class="nv">$keyContent</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
    <span class="nv">$publicKey</span> <span class="o">=</span> <span class="nb">openssl_get_publickey</span><span class="p">(</span><span class="nv">$keyContent</span><span class="p">);</span>
    <span class="nv">$strPayload</span> <span class="o">=</span> <span class="s2">"226:DUSUPAY405GZM1G5JXGA71IK:COMPLETED:https://www.sample-url.com/callback"</span><span class="p">;</span>
    <span class="nv">$signature</span> <span class="o">=</span> <span class="nb">base64_decode</span><span class="p">(</span><span class="s2">"value-of-dusupay-signature"</span><span class="p">);</span>

    <span class="cm">/*true or false*/</span>
    <span class="k">return</span> <span class="nb">openssl_verify</span><span class="p">(</span><span class="nv">$strPayload</span><span class="p">,</span> <span class="nv">$signature</span><span class="p">,</span> <span class="nv">$publicKey</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span>





//
</code></pre><h1 id='payment-options-providers-api'>Payment Options/providers Api</h1><h2 id='description'>Description</h2>
<ul>
<li>Use this api to get <code>provider_ids</code>, <code>bank codes</code> and <code>bank branches</code> where applicable.</li>
<li>Each <code>provider_id</code> used to process a payment has a base currency e.g <code>mtn_ug</code> has <code>UGX</code>, <code>mtn_cm</code> has <code>XAF</code>, <code>international_usd</code> has <code>USD</code>.</li>
<li>This means the merchant sub-account affected by the transaction is one that matches the base currency once a transaction completes. </li>
<li>This further means that a collection using <code>mtn_ug</code> provider id will credit the <code>UGX</code> sub-account while a payout of the same will debit the <code>UGX</code> sub-account balance.</li>
<li>The request currency does not matter because the amount in request currency is converted to the <code>provider_id</code> base currency. <br>
e.g if you request a <code>collection of 10 USD</code> using the provider_id <code>mtn_ug</code>, we will convert the 10 USD to UGX, process and debit the customer in UGX because it&#39;s what the <code>provider_id</code> supports and credit your <code>UGX</code> sub-account which is what matches the base currency of the <code>provider_id</code></li>
</ul>
<h2 id='request-description'>Request Description</h2>
<ul>
<li>content-type: application/json</li>
<li>endpoint: /v1/payment-options/{{type}}/{{method}}/{{country}}?api_key={{api_key}}</li>
<li>method: GET</li>
</ul>
<pre class="highlight ruby tab-ruby"><code><span class="n">example</span> <span class="no">URL</span><span class="p">:</span>

<span class="no">GET</span><span class="p">:</span> <span class="n">https</span><span class="ss">:/</span><span class="o">/</span><span class="n">api</span><span class="p">.</span><span class="nf">dusupay</span><span class="p">.</span><span class="nf">com</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">payment</span><span class="o">-</span><span class="n">options</span><span class="o">/</span><span class="n">collection</span><span class="o">/</span><span class="n">mobile_money</span><span class="o">/</span><span class="n">ug?api_key</span><span class="o">=</span><span class="p">{{</span><span class="n">api_key</span><span class="p">}}</span>
</code></pre><pre class="highlight ruby tab-ruby"><code><span class="n">example</span> <span class="no">Response</span><span class="p">:</span>
</code></pre><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"success"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Request completed successfully."</span><span class="p">,</span><span class="w">
    </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mtn_ug"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MTN Mobile Money"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"airtel_ug"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Airtel Money"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><h3 id='request-headers'>Request Headers</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Examples Value</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>secret-key</td>
<td>SECK3298j923…</td>
<td>Use your merchant account secret key</td>
</tr>
</tbody></table>
<h3 id='request-query-parameters'>Request Query Parameters</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Examples Value</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>api_key</td>
<td>PUBK3298j923…</td>
<td>Get your public key from your merchant account settings</td>
</tr>
</tbody></table>
<h3 id='request-url-parameters'>Request Url Parameters</h3>
<table><thead>
<tr>
<th>Paramater</th>
<th>Examples</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>type</td>
<td>collection</td>
<td>If you want collection options returned</td>
</tr>
<tr>
<td></td>
<td>payout</td>
<td>If you want payout options returned</td>
</tr>
<tr>
<td>method</td>
<td>MOBILE_MONEY,</td>
<td>For Mobile Money</td>
</tr>
<tr>
<td></td>
<td>BANK,</td>
<td>For Bank</td>
</tr>
<tr>
<td></td>
<td>CARD,</td>
<td>For Card</td>
</tr>
<tr>
<td></td>
<td>CRYPTO,</td>
<td>For Crypto Currency</td>
</tr>
<tr>
<td>country</td>
<td>NG</td>
<td>The ISO2 code of the countries supported<br> e.g. UG,KE,NG,ZM,..</td>
</tr>
</tbody></table>
<h3 id='response-fields'>Response Fields</h3>
<table><thead>
<tr>
<th>field</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>Use <code>id</code> where a <code>provider_id</code> is required</td>
</tr>
<tr>
<td>name</td>
<td>The provider name</td>
</tr>
</tbody></table>
<h3 id='supported-countries'>Supported countries</h3>
<table><thead>
<tr>
<th>code</th>
<th>name</th>
<th>Method</th>
</tr>
</thead><tbody>
<tr>
<td>UG</td>
<td>Uganda</td>
<td>- MOBILE_MONEY (Collection, Payout) <br>- CARD (Collection) <br>- BANK(Payout)</td>
</tr>
<tr>
<td>KE</td>
<td>Kenya</td>
<td>- MOBILE_MONEY (Collection, Payout) <br>- CARD (Collection) <br>- BANK(Payout)</td>
</tr>
<tr>
<td>RW</td>
<td>Rwanda</td>
<td>- MOBILE_MONEY (Collection, Payout)</td>
</tr>
<tr>
<td>BI</td>
<td>Burundi</td>
<td>- MOBILE_MONEY (Collection, Payout)</td>
</tr>
<tr>
<td>GH</td>
<td>Ghana</td>
<td>- MOBILE_MONEY (Collection, Payout) <br>- CARD (Collection) <br>- BANK(Payout)</td>
</tr>
<tr>
<td>CM</td>
<td>Cameroon</td>
<td>- MOBILE_MONEY (Collection, Payout)</td>
</tr>
<tr>
<td>ZA</td>
<td>South Africa</td>
<td>- BANK (Collection, Payout)</td>
</tr>
<tr>
<td>NG</td>
<td>Nigeria</td>
<td>- CARD(Collection) <br>- BANK (Collection, Payout)</td>
</tr>
<tr>
<td>ZM</td>
<td>Zambia</td>
<td>- MOBILE_MONEY (Collection, Payout)</td>
</tr>
<tr>
<td>CI</td>
<td>Ivory Coast</td>
<td>- MOBILE_MONEY (Collection, Payout) <br>- BANK(Payout)</td>
</tr>
<tr>
<td>SN</td>
<td>Senegal</td>
<td>- MOBILE_MONEY (Collection, Payout)</td>
</tr>
<tr>
<td>TZ</td>
<td>Tanzania</td>
<td>- MOBILE_MONEY (Collection, Payout) <br>- BANK(Payout)</td>
</tr>
<tr>
<td>US</td>
<td>U.S.A</td>
<td>- CARD, CRYPTO (Collection) <br>- BANK(Payout)</td>
</tr>
<tr>
<td>GB</td>
<td>United Kingdom</td>
<td>CARD, CRYPTO (Collection) <br>- BANK (payout)</td>
</tr>
<tr>
<td>EU</td>
<td>Europe</td>
<td>CARD, CRYPTO (Collection) <br>- BANK (payout)</td>
</tr>
</tbody></table>
<h3 id='comming-soon'>Comming soon</h3><h4 id='west-african-cfa-franc-xof'>West African CFA franc - XOF</h4>
<ul>
<li>Benin</li>
<li>Burkina Faso</li>
<li>Guinea-Bissau</li>
<li>Mali, Niger</li>
<li>Togo</li>
<li>Central African CFA franc - XAF</li>
<li>Central African Republic</li>
<li>Chad</li>
<li>Republic of the Congo</li>
<li>Equatorial Guinea</li>
<li>Gabon</li>
</ul>
<h4 id='cash-payments'>Cash payments</h4>
<ul>
<li>We are working to enable customers to pay you by <code>CASH</code> as a <code>collection</code> method</li>
<li>We are working to enable you to pay customers by <code>CASH</code> as a <code>payout</code> method</li>
</ul>
<h1 id='bank-branches-api'>Bank Branches Api</h1>
<p>Some countries require bank branches for bank payouts to be made. Use this api to get the branches of a given bank code.</p>

<ul>
<li>content-type: application/json</li>
<li>endpoint: /v1/{method}/{country}/branches/{bank_code}?api_key={{api_key}}</li>
<li>method: GET</li>
</ul>
<pre class="highlight ruby tab-ruby"><code><span class="n">example</span> <span class="no">URL</span><span class="p">:</span>

<span class="no">GET</span><span class="p">:</span> <span class="n">https</span><span class="ss">:/</span><span class="o">/</span><span class="n">api</span><span class="p">.</span><span class="nf">dusupay</span><span class="p">.</span><span class="nf">com</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">bank</span><span class="o">/</span><span class="n">gh</span><span class="o">/</span><span class="n">branches</span><span class="o">/</span><span class="no">GH030100</span><span class="p">?</span><span class="n">api_key</span><span class="o">=</span><span class="p">{{</span><span class="n">api_key</span><span class="p">}}</span>

<span class="no">Where</span> <span class="no">GH030100</span> <span class="n">is</span> <span class="n">the</span> <span class="n">bank_code</span>

</code></pre><pre class="highlight ruby tab-ruby"><code><span class="n">example</span> <span class="no">Response</span><span class="p">:</span>
</code></pre><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"success"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Request completed successfully."</span><span class="p">,</span><span class="w">
  </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GH030243"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BARCLAYS BANK(GH) LTD-NKAWKAW"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GH030116"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BARCLAYS BANK (GH) LTD-BCM"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GH030653"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BARCLAYS BANK(GH)NEW SUAME MAGAZINE"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><h3 id='request-headers'>Request Headers</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Examples Value</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>secret-key</td>
<td>SECK3298j923…</td>
<td>Use your merchant account secret key</td>
</tr>
</tbody></table>
<h3 id='request-query-parameters'>Request Query Parameters</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Examples Value</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>api_key</td>
<td>PUBK3298j923…</td>
<td>Get your public key from your merchant account settings</td>
</tr>
</tbody></table>
<h3 id='request-url-parameters'>Request Url Parameters</h3>
<table><thead>
<tr>
<th>Paramater</th>
<th>Examples</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>bank_code</td>
<td>GH030100</td>
<td>These come from the list of banks returned by the payment options api.</td>
</tr>
<tr>
<td>method</td>
<td>MOBILE_MONEY,</td>
<td>For Mobile Money</td>
</tr>
<tr>
<td></td>
<td>BANK,</td>
<td>For Bank</td>
</tr>
<tr>
<td></td>
<td>CARD,</td>
<td>For Card</td>
</tr>
<tr>
<td>country</td>
<td>GH</td>
<td>The ISO2 code of the countries supported<br> e.g. GH <br><br> View countries that require a branch_code from the <a href="#extra-parameters">Payout Extra Parameters</a> section</td>
</tr>
</tbody></table>
<h3 id='response-fields'>Response Fields</h3>
<table><thead>
<tr>
<th>field</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>code</td>
<td>Use <code>code</code> where a <code>branch_code</code> is required</td>
</tr>
<tr>
<td>name</td>
<td>The Branch name</td>
</tr>
</tbody></table>
<h1 id='account-balance'>Account Balance</h1>
<ul>
<li>content-type: application/json</li>
<li>endpoint: /v1/merchants/balance?api_key={{api_key}}</li>
<li>method: GET</li>
</ul>
<pre class="highlight ruby tab-ruby"><code><span class="no">GET</span><span class="p">:</span> <span class="n">https</span><span class="ss">:/</span><span class="o">/</span><span class="n">api</span><span class="p">.</span><span class="nf">dusupay</span><span class="p">.</span><span class="nf">com</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">merchants</span><span class="o">/</span><span class="n">balance?api_key</span><span class="o">=</span><span class="p">{{</span><span class="n">api_key</span><span class="p">}}</span>
</code></pre><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"success"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Request completed successfully."</span><span class="p">,</span><span class="w">
    </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UGX"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"balance"</span><span class="p">:</span><span class="w"> </span><span class="mf">5475.816</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"USD"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"balance"</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><h2 id='request-headers'>Request Headers</h2>
<p>Parameter   | Examples      | Description
secret-key  | SECK3298j923  | Use your merchant account secret key</p>
<h2 id='query-parameters'>Query Parameters</h2>
<table><thead>
<tr>
<th>Parameter</th>
<th>Examples</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>api_key</td>
<td>PUBK3298j923</td>
<td>Get your public key from your merchant account settings</td>
</tr>
</tbody></table>
<h1 id='refund'>Refund</h1>
<ul>
<li>content-type: application/json</li>
<li>endpoint: /v1/refund</li>
<li>method: POST</li>
</ul>
<pre class="highlight ruby tab-ruby"><code><span class="no">POST</span><span class="p">:</span> <span class="n">https</span><span class="ss">:/</span><span class="o">/</span><span class="n">api</span><span class="p">.</span><span class="nf">dusupay</span><span class="p">.</span><span class="nf">com</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">refund</span>
</code></pre><pre class="highlight plaintext"><code>Sample Request
</code></pre><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"api_key"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
    </span><span class="s2">"internal_reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"This is sent back in the api response or callback"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>api_key</td>
<td>Merchant account public key.</td>
</tr>
<tr>
<td>internal_reference</td>
<td>This is the <code>internal_reference</code> of the transaction to be refunded. <br>This value is returned in the api response or webhook/callback data sent to your webhook url.</td>
</tr>
</tbody></table>
<pre class="highlight plaintext"><code>Sample Response
</code></pre><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">202</span><span class="p">,</span><span class="w">
    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"accepted"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Refund Initiated Successfully"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">65205</span><span class="p">,</span><span class="w">
        </span><span class="s2">"refund_amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">1054</span><span class="p">,</span><span class="w">
        </span><span class="s2">"refund_currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UGX"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"transaction_fee"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
        </span><span class="s2">"total_debit"</span><span class="p">:</span><span class="w"> </span><span class="mi">1054</span><span class="p">,</span><span class="w">
        </span><span class="s2">"provider_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"international_ugx"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"collection_reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DUSUPAYXYXYXYXYXYXYXYXYX"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"internal_reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"RFD-DUSUPAYXYXYXYXYXYXYXYXYX-3486003"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"transaction_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"refund"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"transaction_status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PENDING"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"account_number"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4860610032773134"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Request Initiated"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><h2 id='request-headers'>Request Headers</h2>
<p>Parameter   | Examples      | Description
secret-key  | SECK3298j923  | Use your merchant account secret key</p>
<h2 id='query-parameters'>Query Parameters</h2>
<table><thead>
<tr>
<th>Parameter</th>
<th>Examples</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>api_key</td>
<td>PUBK3298j923</td>
<td>Get your public key from your merchant account settings</td>
</tr>
</tbody></table>
<h2 id='note'>Note</h2>
<ul>
<li>The sandbox does not support refunds.</li>
<li>Currently, we only supporte <code>full refunds</code></li>
<li>Currently, you can only refund <code>card</code> transactions</li>
<li>For <code>mobile_money</code> we recommend that you instead make a payout to the customer</li>
<li>When you make a refund request, we refund the customer the exact amount that was paid by the customer in the original transaction. The details are returned in the api response. <br>The funds are debited from your merchant account and a refund request is created for processing.</li>
<li>We will also make a callback to your webhook/callback url set under your merchant account.</li>
<li>Sample webhook data can be found in the <a href="#webhooks">webhook’s section</a></li>
</ul>
<h1 id='testing-sandbox'>Testing Sandbox</h1><h2 id='description'>Description</h2>
<ul>
<li><p>The sandbox works like the live platform and therefore, after integrating it, you will simply ned to change the base-url and API keys to those meant for the live API.</p></li>
<li><p>Customer accounts to test for both failure and complete transactions are returned by the sandbox payment options API. </p></li>
</ul>
<h2 id='base-url'>Base URL</h2>
<p>https://sandbox.dusupay.com</p>
<h2 id='test-account'>Test Account</h2>
<p>Sign up from http://sandbox.merchant.dusupay.com</p>
<h3 id='test-collections-api'>Test Collections API</h3>
<p>https://sandbox.dusupay.com/v1/collections</p>
<h3 id='test-payouts-api'>Test Payouts API</h3>
<p>https://sandbox.dusupay.com/v1/payouts</p>
<h3 id='recommended-tests-for-the-sandbox'>Recommended tests for the sandbox</h3><h4 id='test-mobilemoney'>Test MobileMoney</h4>
<ul>
<li>Test with the provider <code>mtn_ug</code> and <code>mtn_gh</code>. This will make sure all the <code>mobile_money</code>  provider_id&#39;s will work correctly in production.</li>
</ul>
<h4 id='test-card'>Test Card</h4>
<ul>
<li>Test with the provider <code>international_usd</code>. This will make sure all the <code>card</code> provider_id&#39;s will work correctly in production.</li>
</ul>
<h4 id='test-paymenturl-returned'>Test PaymentURL returned</h4>
<ul>
<li>For all payments that need to be completed in the browser, we return a <code>payment_url</code> similar to how we return <code>payment_urls</code> when processing with cards.</li>
<li>Therefore, all methods we add in the future that use a <code>payment_url</code> will work the same way as <code>card</code> payments. The processing flow will be the same.</li>
<li>This means that you should always redirect the customer whenever you find the <code>payment_url</code> field populated with a url. </li>
<li>This also means, in the event we get a mobile money option that uses <code>payment_url</code>, you will have nothing to change in how you will be handling the workflow.</li>
</ul>
<h3 id='moving-to-production'>Moving to production.</h3>
<ul>
<li>Set the <code>webhook_url</code> under your merchant account &gt; Settings &gt; Api Settings &gt; Edit</li>
<li>Replace the api credentials with those from your live merchant account</li>
<li>Ensure that the api urls are correct and that they are the production urls</li>
<li>Ensure that the api response data is nolonger manually modified with static values.</li>
</ul>
<h1 id='faq-frequently-asked-questions'>FAQ - Frequently Asked Questions</h1><h2 id='1-where-do-i-find-my-webhook-hash'>1. Where do i find my webhook hash</h2>
<p>You are expected to simply generate a random string that cannot be guessed and used as the webhook hash value wherever needed. </p>

<p><br><br> This is used to verify that the callback request was sent from dusupay and your app should accept it since only your app and our system know the webhook hash value.</p>

<p><br><br>All you have to make sure is that the webhook hash used on the dusupay dashboard matches the one expected by your app or website since it will be included in the webhook request header sent to your callback or webhook url.</p>

<p><br><br>Make sure you also avoid leading space when Copying and Pasting the webhook hash between your app and ours system.</p>
<h2 id='2-we-didn-39-t-received-any-notification-callback-ipn-data-or-how-can-see-the-data-request-body-posted-to-the-webhook-url'>2. We didn&#39;t received any notification/callback/IPN data or how can see the data/request body posted to the webhook url</h2>
<p>Create a callback url from <a href="https://webhook.site">https://webhook.site</a> or <a href="https://beeceptor.com/">https://beeceptor.com/</a> 
<br>
and use it as a callback URL. 
<br><br>
Run your tests and all the details of the callback request will be displayed on that <code>webhook.site</code> or <code>beeceptor.com</code> interface depending the one you used.
<br><br></p>

<ul>
<li>It will also help you see what we POST before implementing your side.</li>
<li>It also helps to confirm that it&#39;s your side that needs to be corrected to receive the data posted</li>
</ul>
<h2 id='3-why-provider_id-is-required-even-for-mobile-money-api-requests'>3. Why provider_id is required even for mobile money api requests</h2>
<p>Adopting the idea of letting the customer choose the provider at all times early enough gives you more control on what extra data to ask from the client for those exceptional operators like Vodafone in Ghana.
<br><br>
As we add more operators, extra data might be required to be picked from the customer depending on the operator. Therefore it’s necessary to be aware of the operator in action.</p>
<h3 id='therefore-the-checkout-flow-would-look-like-below'>Therefore the checkout flow would look like below;</h3>
<ul>
<li>The customer chooses to pay at ckeckout.</li>
<li>The customer chooses a country to pay from if not known already e.g Uganda</li>
<li>The customer chooses payment method for the country selected
<br>e.g mobile_money - Mobile Money</li>
<li>The customer chooses provider e.g airtel_ug - Airtel Money Uganda
<br><br>
You could also combine the method and provider such that the customer only chooses the provider. Using the provider_id selected, you can determine the method it belongs to. You would need to maintain a list of the payment options you want the customer to choose from that helps you determine the provider method. It’s all up to you and the customer experience.
<br><br>
Since you now know the provider selected, you can validate the account number that will be entered next if necessary and further ask for extra data if any is required for a given provider.
e.g You can now go ahead and tell the client that selected vodafone_gh - Ghana to generate a voucher and enter it in a given field then you submit it along with the request.
<br><br>
It’s up to you to design the interface to give the customer better checkout experience.</li>
<li>Once you have submited the transaction details to the api for processing, we return a <code>payment_url</code> where we expect you do redirect the customer and if it&#39;s empty, we usually return <code>instructions</code> to display to the customer. The <code>instructions</code> returned are mainly useful for async processing e.g mobile money transactions</li>
<li>So if instructions are returned, we recommend that you add button on the screen that displays the <code>instructions</code> which leads them to a page that displays the status of the transaction <code>polled</code> or fetched from your application&#39;s Database.</li>
<li>The transaction status will change when we notify you via the webhook/callback url set under your merchant account.</li>
</ul>
<h2 id='4-are-all-funds-collected-via-different-operators-provider_id-in-the-same-country-combine'>4. Are all funds collected via different operators/provider_id in the same country combine.</h2><h3 id='yes'>Yes.</h3>
<p>When one customer pays 1,000 UGX via airtel_ug and another pays 2,000 UGX via mtn_ug, your balance will reflect 3,000 UGX in the UGX subaccount under your merchant account.
<br><br>
This holds true with the assumption that there were zero transaction fees or the customer paid the transaction fees.</p>
<h2 id='5-are-payouts-now-instant'>5. Are payouts now instant.</h2><h3 id='yes-and-no'>Yes and no.</h3>
<p>Most of the mobile_money payouts are instant, 90% of most of the time. The other lag is based on the speed of the service provider/operator enabling the payout. <br>
However, our system releases them instantly to be processed and paid out.
<br><br>
For some countries like <code>South Africa</code>. Our partner could take 2-4 days for the transaction to complete or reflect as complete in our system.</p>

<p>But most of the partners will complete the bank payout between instant e.g <code>Nigeria</code> and one day.</p>
<h2 id='6-where-are-the-old-dusupay-api-doc'>6. Where are the old dusupay api doc.</h2>
<p>https://dusupay.com/docs/build</p>
<h2 id='7-fnb-bank-south-africa-01-invalid-to-product-number-one-of-our-clients-face-the-error-when-choosing-fnb-bank-for-deposit-what-does-it-mean-what-can-we-recommend-to-the-client'>7. FNB Bank South Africa - 01 Invalid To Product Number. One of our clients face the error when choosing FNB bank for deposit. What does it mean? What can we recommend to the client?</h2>
<p>Does the client have any other listed beneficiaries on their account?  <br>
The error is from FNB . It looks like they are doing a CDV check for products on the account number. Then it fails hence they are unable to complete the payment.</p>

<p><br><br>
The issue is with the clients bank account/FNB not with EFT secure. We think the BANK account verification FNB does fails. It could be because there are other beneficiaries on the account.
<br><br>
Other bank accounts or banks should work. </p>

<p>Note that during the EFT secure payment, if the bank is unable to process payment for any reason, it will fail.</p>
<h2 id='8-alidropship'>8. Alidropship</h2><h3 id='error-merchant-account-unknown'>Error - Merchant account unknown</h3>
<ul>
<li>Please turn off demo mode from your plugin settings</li>
</ul>
<h3 id='error-processing-payment'>Error Processing payment</h3>
<ul>
<li><p>If you are testing with mobile money, make sure that the charge amount is sufficient enough on your mobile money wallet.
<br><br>We recommend that if you are testing, you create an item on your store with a small price that your mobile money wallet can afford to pay.</p></li>
<li><p>Make sure that you have the payment method you are trying to use enabled under your merchant account. You would need to contact legal@dusupay.com for clarification.</p></li>
</ul>
<h3 id='card-payment-method-issue'>Card payment method issue</h3>
<ul>
<li>If you are trying to test with cards and you get an error whereby you do not even get the chance to enter card details anywhere, chances are that the card method is not enabled on your merchant account. You would need to contact legal@dusupay.com for clarification or to enable it. </li>
</ul>
<h1 id='plugins-and-libraries'>Plugins And Libraries</h1><h2 id='plugins'>Plugins</h2>
<table><thead>
<tr>
<th>Platform</th>
<th>Link</th>
</tr>
</thead><tbody>
<tr>
<td>Woocommerce</td>
<td><a target="_blank" href="https://wordpress.org/plugins/dusupay-payment-gateway-for-woocommerce/">Check out</a></td>
</tr>
</tbody></table>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="json">JS/Json</a>
                <a href="#" data-language-name="shell">Shell</a>
                <a href="#" data-language-name="javascript">NodeJS</a>
                <a href="#" data-language-name="php">PHP</a>
          </div>
      </div>
    </div>
  </body>
</html>
